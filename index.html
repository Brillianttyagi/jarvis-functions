<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Task Graph - DAG Visualization</title>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #1a1a1a;
            color: white;
            overflow: hidden;
            height: 100vh;
            user-select: none;
        }

        .toolbar {
            position: fixed;
            top: 20px;
            left: 20px;
            z-index: 1000;
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .btn {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: white;
            padding: 10px 16px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .btn:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: translateY(-1px);
        }

        .btn.active {
            background: rgba(74, 144, 226, 0.3);
            border-color: rgba(74, 144, 226, 0.5);
        }

        .canvas-container {
            width: 100vw;
            height: 100vh;
            position: relative;
            overflow: hidden;
            background:
                radial-gradient(circle at 20% 20%, rgba(74, 144, 226, 0.15) 0%, transparent 40%),
                radial-gradient(circle at 80% 30%, rgba(156, 39, 176, 0.15) 0%, transparent 40%),
                radial-gradient(circle at 40% 80%, rgba(255, 107, 107, 0.1) 0%, transparent 40%),
                radial-gradient(circle at 90% 90%, rgba(78, 205, 196, 0.1) 0%, transparent 40%),
                linear-gradient(135deg, #0f0f0f 0%, #1a1a1a 50%, #2d2d2d 100%);
            background-attachment: fixed;
            animation: backgroundShift 20s ease-in-out infinite alternate;
        }

        .infinite-canvas {
            width: 100%;
            height: 100%;
            cursor: grab;
        }

        .infinite-canvas.grabbing {
            cursor: grabbing;
        }

        .infinite-canvas.connecting {
            cursor: crosshair;
        }

        .grid-pattern {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            opacity: 0.08;
            background-image:
                linear-gradient(rgba(255,255,255,0.15) 1px, transparent 1px),
                linear-gradient(90deg, rgba(255,255,255,0.15) 1px, transparent 1px),
                linear-gradient(rgba(74, 144, 226, 0.05) 1px, transparent 1px),
                linear-gradient(90deg, rgba(74, 144, 226, 0.05) 1px, transparent 1px);
            background-size: 100px 100px, 100px 100px, 20px 20px, 20px 20px;
            pointer-events: none;
            animation: gridShift 15s ease-in-out infinite alternate;
        }

        @keyframes gridShift {
            0% { transform: translate(0, 0); }
            100% { transform: translate(10px, 10px); }
        }

        .node {
            cursor: pointer;
        }

        .node-circle {
            fill: rgba(255, 255, 255, 0.08);
            stroke: rgba(74, 144, 226, 0.7);
            stroke-width: 2px;
            filter: drop-shadow(0px 4px 12px rgba(0, 0, 0, 0.4)) drop-shadow(0px 0px 20px rgba(255, 255, 255, 0.1));
            transition: all 0.4s ease;
            animation: nodeGlow 4s ease-in-out infinite;
        }

        .node-circle:hover {
            fill: rgba(74, 144, 226, 0.15);
            stroke: rgba(74, 144, 226, 1);
            stroke-width: 4px;
            filter: drop-shadow(0px 8px 20px rgba(74, 144, 226, 0.5)) drop-shadow(0px 0px 30px rgba(74, 144, 226, 0.3));
            transform: scale(1.05);
        }

        .node-circle.selected {
            fill: rgba(74, 144, 226, 0.25);
            stroke: rgba(74, 144, 226, 1);
            stroke-width: 4px;
            filter: drop-shadow(0px 0px 25px rgba(74, 144, 226, 0.8)) drop-shadow(0px 4px 15px rgba(74, 144, 226, 0.4));
            transform: scale(1.08);
        }

        .node-label {
            fill: white;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            font-size: 12px;
            font-weight: 600;
            text-anchor: middle;
            pointer-events: none;
            user-select: none;
        }

        .node-description {
            fill: rgba(255, 255, 255, 0.7);
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            font-size: 10px;
            text-anchor: middle;
            pointer-events: none;
            user-select: none;
        }

        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(76, 175, 80, 0.4); }
            70% { box-shadow: 0 0 0 10px rgba(76, 175, 80, 0); }
            100% { box-shadow: 0 0 0 0 rgba(76, 175, 80, 0); }
        }

        @keyframes twinkle {
            0%, 100% { opacity: 0.3; transform: scale(0.8); }
            50% { opacity: 1; transform: scale(1.2); }
        }

        @keyframes rotate {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }

        @keyframes backgroundShift {
            0% {
                background:
                    radial-gradient(circle at 20% 20%, rgba(74, 144, 226, 0.15) 0%, transparent 40%),
                    radial-gradient(circle at 80% 30%, rgba(156, 39, 176, 0.15) 0%, transparent 40%),
                    radial-gradient(circle at 40% 80%, rgba(255, 107, 107, 0.1) 0%, transparent 40%),
                    radial-gradient(circle at 90% 90%, rgba(78, 205, 196, 0.1) 0%, transparent 40%),
                    linear-gradient(135deg, #0f0f0f 0%, #1a1a1a 50%, #2d2d2d 100%);
            }
            100% {
                background:
                    radial-gradient(circle at 80% 80%, rgba(74, 144, 226, 0.15) 0%, transparent 40%),
                    radial-gradient(circle at 20% 70%, rgba(156, 39, 176, 0.15) 0%, transparent 40%),
                    radial-gradient(circle at 60% 20%, rgba(255, 107, 107, 0.1) 0%, transparent 40%),
                    radial-gradient(circle at 10% 10%, rgba(78, 205, 196, 0.1) 0%, transparent 40%),
                    linear-gradient(135deg, #1a1a1a 0%, #2d2d2d 50%, #0f0f0f 100%);
            }
        }

        @keyframes nodeGlow {
            0%, 100% {
                filter: drop-shadow(0px 4px 12px rgba(0, 0, 0, 0.4)) drop-shadow(0px 0px 20px rgba(255, 255, 255, 0.1));
            }
            50% {
                filter: drop-shadow(0px 4px 12px rgba(0, 0, 0, 0.4)) drop-shadow(0px 0px 25px rgba(255, 255, 255, 0.2));
            }
        }

        .star {
            animation: twinkle 2s ease-in-out infinite;
        }

        .star.rotating {
            animation: twinkle 2s ease-in-out infinite, rotate 8s linear infinite;
        }

        .star.floating {
            animation: twinkle 3s ease-in-out infinite, float 4s ease-in-out infinite;
        }

        .task-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 8px;
        }

        .task-title {
            font-size: 16px;
            font-weight: 600;
            color: white;
            word-wrap: break-word;
            flex: 1;
        }

        .task-actions {
            display: flex;
            gap: 4px;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .task-node:hover .task-actions {
            opacity: 1;
        }

        .action-btn {
            background: rgba(255, 255, 255, 0.1);
            border: none;
            color: white;
            padding: 4px 6px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            transition: background 0.2s ease;
        }

        .action-btn:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .task-description {
            font-size: 13px;
            color: rgba(255, 255, 255, 0.7);
            line-height: 1.4;
            word-wrap: break-word;
        }

        .link {
            stroke: rgba(74, 144, 226, 0.6);
            stroke-width: 2px;
            fill: none;
            marker-end: url(#arrowhead);
            transition: all 0.3s ease;
        }

        .link:hover {
            stroke: rgba(74, 144, 226, 1);
            stroke-width: 3px;
            filter: drop-shadow(0px 0px 8px rgba(74, 144, 226, 0.4));
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 2000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(5px);
        }

        .modal-content {
            background: rgba(30, 30, 30, 0.95);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            margin: 10% auto;
            padding: 30px;
            border-radius: 15px;
            width: 90%;
            max-width: 400px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .modal-title {
            font-size: 1.3em;
            font-weight: 600;
            color: white;
        }

        .close {
            background: none;
            border: none;
            font-size: 24px;
            font-weight: bold;
            cursor: pointer;
            color: rgba(255, 255, 255, 0.7);
            transition: color 0.3s ease;
        }

        .close:hover {
            color: white;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 6px;
            font-weight: 600;
            color: rgba(255, 255, 255, 0.9);
            font-size: 14px;
        }

        .form-group input,
        .form-group textarea {
            width: 100%;
            padding: 12px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            color: white;
            font-size: 14px;
            transition: all 0.3s ease;
        }

        .form-group input:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: rgba(74, 144, 226, 0.6);
            background: rgba(255, 255, 255, 0.08);
        }

        .form-group textarea {
            resize: vertical;
            min-height: 80px;
            font-family: inherit;
        }

        .form-actions {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
            margin-top: 30px;
        }

        .status-indicator {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            padding: 10px 15px;
            font-size: 12px;
            color: rgba(255, 255, 255, 0.8);
        }

        .description-popup {
            position: fixed;
            background: rgba(0, 0, 0, 0.9);
            backdrop-filter: blur(15px);
            border: 2px solid rgba(74, 144, 226, 0.5);
            border-radius: 15px;
            padding: 25px;
            max-width: 450px;
            min-width: 350px;
            max-height: 400px;
            overflow-y: auto;
            overflow-x: hidden;
            color: white;
            box-shadow:
                0 20px 60px rgba(0, 0, 0, 0.6),
                0 0 30px rgba(74, 144, 226, 0.3);
            z-index: 1001;
            opacity: 0;
            scale: 0.1;
            transition: all 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
            pointer-events: none;
            transform-origin: center center;
        }

        /* Custom scrollbar for popup */
        .description-popup::-webkit-scrollbar {
            width: 12px;
        }

        .description-popup::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.2);
            border-radius: 10px;
            margin: 5px;
        }

        .description-popup::-webkit-scrollbar-thumb {
            background: linear-gradient(135deg, #4A90E2, #74B9FF);
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(74, 144, 226, 0.5);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .description-popup::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(135deg, #74B9FF, #4A90E2);
            box-shadow: 0 0 15px rgba(74, 144, 226, 0.8);
        }

        /* Firefox scrollbar */
        .description-popup {
            scrollbar-width: thin;
            scrollbar-color: #4A90E2 rgba(255, 255, 255, 0.1);
        }

        .description-popup.show {
            opacity: 1;
            scale: 1;
            pointer-events: auto;
        }

        .description-popup.closing {
            opacity: 0;
            scale: 0.1;
            transition: all 0.3s cubic-bezier(0.55, 0.055, 0.675, 0.19);
        }

        .popup-title {
            font-size: 18px;
            font-weight: bold;
            color: #4A90E2;
            margin-bottom: 15px;
            text-shadow: 0 0 10px rgba(74, 144, 226, 0.5);
            border-bottom: 1px solid rgba(74, 144, 226, 0.3);
            padding-bottom: 8px;
        }

        .popup-description {
            font-size: 13px;
            line-height: 1.6;
            color: rgba(255, 255, 255, 0.9);
            margin-bottom: 15px;
            white-space: pre-line;
        }

        .popup-section {
            margin-bottom: 12px;
        }

        .popup-section-title {
            font-size: 12px;
            font-weight: bold;
            color: #4A90E2;
            margin-bottom: 6px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .popup-tech-list {
            font-size: 11px;
            color: rgba(255, 255, 255, 0.8);
            line-height: 1.4;
            padding-left: 10px;
            white-space: pre-line;
        }

        .popup-id {
            font-size: 10px;
            color: rgba(255, 255, 255, 0.4);
            font-family: monospace;
            text-align: right;
            margin-top: 10px;
            padding-top: 8px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }

        .popup-close-hint {
            font-size: 9px;
            color: rgba(255, 255, 255, 0.3);
            text-align: center;
            margin-top: 8px;
            font-style: italic;
        }

        .zoom-controls {
            position: fixed;
            bottom: 20px;
            left: 20px;
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .zoom-btn {
            width: 40px;
            height: 40px;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: white;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .zoom-btn:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        @media (max-width: 768px) {
            .toolbar {
                flex-wrap: wrap;
                max-width: calc(100vw - 40px);
            }

            .btn {
                padding: 8px 12px;
                font-size: 12px;
            }

            .task-node {
                min-width: 120px;
                max-width: 200px;
                padding: 12px;
            }

            .modal-content {
                width: 95%;
                margin: 5% auto;
                padding: 20px;
            }
        }
    </style>
</head>
<body>
    <div class="toolbar">
        <button class="btn" onclick="centerView()">
            🎯 Center View
        </button>
        <button class="btn" onclick="autoLayout()">
            🔄 Auto Layout
        </button>
    </div>

    <div class="zoom-controls">
        <button class="zoom-btn" onclick="zoomIn()">+</button>
        <button class="zoom-btn" onclick="zoomOut()">-</button>
        <button class="zoom-btn" onclick="resetZoom()" style="font-size: 12px;">⌂</button>
    </div>

    <div class="canvas-container">
        <div class="grid-pattern" id="grid"></div>
        <svg class="infinite-canvas" id="svg-canvas">
            <defs>
                <marker id="arrowhead" markerWidth="10" markerHeight="7"
                    refX="9" refY="3.5" orient="auto" fill="rgba(74, 144, 226, 0.6)">
                    <polygon points="0 0, 10 3.5, 0 7" />
                </marker>

                <!-- Star shapes -->
                <g id="star-4">
                    <path d="M0,-8 L2,-2 L8,0 L2,2 L0,8 L-2,2 L-8,0 L-2,-2 Z" fill="white" opacity="0.8"/>
                </g>

                <g id="star-6">
                    <path d="M0,-6 L1.5,-1.5 L6,0 L1.5,1.5 L0,6 L-1.5,1.5 L-6,0 L-1.5,-1.5 Z" fill="white" opacity="0.6"/>
                </g>

                <g id="sparkle">
                    <path d="M0,-4 L1,-1 L4,0 L1,1 L0,4 L-1,1 L-4,0 L-1,-1 Z" fill="white" opacity="0.9"/>
                </g>

                <!-- Glow filters -->
                <filter id="glow">
                    <feGaussianBlur stdDeviation="3" result="coloredBlur"/>
                    <feMerge>
                        <feMergeNode in="coloredBlur"/>
                        <feMergeNode in="SourceGraphic"/>
                    </feMerge>
                </filter>

                <filter id="star-glow">
                    <feGaussianBlur stdDeviation="2" result="coloredBlur"/>
                    <feMerge>
                        <feMergeNode in="coloredBlur"/>
                        <feMergeNode in="SourceGraphic"/>
                    </feMerge>
                </filter>
            </defs>
            <g id="stars-background"></g>
            <g id="graph-container"></g>
        </svg>
    </div>

    <div class="status-indicator" id="status">
        📊 Tasks: <span id="task-count">0</span> | Connections: <span id="connection-count">0</span>
    </div>

    <div class="description-popup" id="description-popup">
        <div class="popup-title" id="popup-title"></div>
        <div class="popup-section">
            <div class="popup-section-title">Description</div>
            <div class="popup-description" id="popup-description"></div>
        </div>
        <div class="popup-section" id="popup-tech-section">
            <div class="popup-section-title">Tech & Libraries</div>
            <div class="popup-tech-list" id="popup-tech-list"></div>
        </div>
        <div class="popup-id" id="popup-id"></div>
        <div class="popup-close-hint">Click anywhere to close</div>
    </div>


    <script>
        // Global state
        let nodes = [];
        let links = [];
        let svg, g, simulation, node, link;
        let width = window.innerWidth;
        let height = window.innerHeight;
        let selectedNode = null;

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            initializeD3();
            loadData();
        });

        function initializeD3() {
            // Setup SVG and zoom
            svg = d3.select("#svg-canvas")
                .attr("width", width)
                .attr("height", height);

            g = d3.select("#graph-container");

            // Setup zoom behavior
            const zoom = d3.zoom()
                .scaleExtent([0.1, 3])
                .on("zoom", function(event) {
                    g.attr("transform", event.transform);
                    d3.select("#stars-background").attr("transform", event.transform);
                });

            svg.call(zoom);

            // Create background stars
            createBackgroundStars();

            // Handle window resize
            window.addEventListener('resize', function() {
                width = window.innerWidth;
                height = window.innerHeight;
                svg.attr("width", width).attr("height", height);
                if (simulation) {
                    simulation.force("center", d3.forceCenter(width / 2, height / 2));
                    simulation.alpha(0.3).restart();
                }
                createBackgroundStars(); // Recreate stars on resize
            });
        }

        function createBackgroundStars() {
            const starsBg = d3.select("#stars-background");
            starsBg.selectAll("*").remove(); // Clear existing stars

            // Create random background stars
            for (let i = 0; i < 50; i++) {
                const x = Math.random() * (width + 400) - 200;
                const y = Math.random() * (height + 400) - 200;
                const starType = Math.random() < 0.5 ? "sparkle" : (Math.random() < 0.5 ? "star-4" : "star-6");
                const animClass = Math.random() < 0.3 ? "rotating" : (Math.random() < 0.5 ? "floating" : "");

                starsBg.append("use")
                    .attr("href", `#${starType}`)
                    .attr("x", x)
                    .attr("y", y)
                    .attr("class", `star ${animClass}`)
                    .style("opacity", Math.random() * 0.6 + 0.2)
                    .style("filter", "url(#star-glow)")
                    .style("animation-delay", `${Math.random() * 4}s`);
            }
        }

        function loadData() {
            // Embedded data - no server required
            const tasks = [
                {"id": 1, "name": "Wake Word Detection", "description": "Detect wake word using CNN model", "tech": "• TensorFlow / PyTorch (CNN model training)\\n• pyaudio (microphone input)\\n• Vosk (offline speech recognition)", "x": 400, "y": 50, "created_at": "2025-09-18T10:00:00"},
                {"id": 2, "name": "Voice Interaction", "description": "Capture voice input, process commands with Whisper, convert text to speech", "tech": "• pyaudio/sounddevice (local audio capture)\\n• Wave format (local audio storage)\\n• Whisper (offline speech-to-text model)\\n• PyTorch/TensorFlow (offline local models)\\n• pyttsx3 (offline text-to-speech)\\n• espeak-ng (offline Linux TTS)", "x": 100, "y": 150, "created_at": "2025-09-18T10:01:00"},
                {"id": 3, "name": "Face Recognition", "description": "Detect faces, authenticate users, optional voice verification", "tech": "• OpenCV (Haar cascades / DNN module)\\n• Dlib (high-accuracy face detection)\\n• Face Recognition (local facial recognition)\\n• PyAudio (voice samples)\\n• SpeakerRecognition (local speaker ID)", "x": 700, "y": 150, "created_at": "2025-09-18T10:02:00"},
                {"id": 4, "name": "General AI (Llama 3)", "description": "Process commands, generate responses, provide recommendations", "tech": "• Llama 3 (offline local text generation)\\n• Hugging Face Transformers (offline models)\\n• Rasa (offline conversational AI)\\n• Scikit-learn (local recommendation engines)\\n• TensorFlow/PyTorch (offline ML models)\\n• ONNX Runtime (optimized inference)", "x": 400, "y": 250, "created_at": "2025-09-18T10:03:00"},
                {"id": 5, "name": "Social Media Integration", "description": "Scrape public data, automate posting, local scripts", "tech": "• BeautifulSoup / Scrapy (web scraping)\\n• Selenium (dynamic content scraping)\\n• Python Requests (HTTP requests)\\n• Selenium (browser automation)", "x": 50, "y": 350, "created_at": "2025-09-18T10:04:00"},
                {"id": 6, "name": "Smart Home Automation", "description": "Control lighting, temperature, voice-based appliances, security cameras", "tech": "• MQTT (local-only device messaging)\\n• Home Assistant/openHAB (offline platforms)\\n• PySerial (direct device communication)\\n• OpenCV (local camera processing)\\n• RTSP (local-only video streaming)\\n• Raspberry Pi GPIO (direct control)\\n• Zigbee/Z-Wave (local mesh networks)", "x": 750, "y": 350, "created_at": "2025-09-18T10:05:00"},
                {"id": 7, "name": "Task Automation", "description": "Automate daily tasks, schedule tasks with cron jobs", "tech": "• Cron Jobs (Linux scheduling)\\n• Celery (task queue management)\\n• APScheduler (local scheduling)", "x": 200, "y": 450, "created_at": "2025-09-18T10:06:00"},
                {"id": 8, "name": "Web Scraping", "description": "Scrape news updates, weather data from local sources", "tech": "• BeautifulSoup (local website scraping)\\n• Scrapy (offline scraping framework)\\n• Requests (local HTTP requests)\\n• Local RSS feed parsing\\n• Custom scrapers (no external APIs)\\n• Local data caching", "x": 600, "y": 450, "created_at": "2025-09-18T10:07:00"},
                {"id": 9, "name": "Security", "description": "Encryption of communications, local data protection", "tech": "• PyCryptodome (AES encryption, local data)\\n• ssl (secure local connections)\\n• SQLite (local database encryption)", "x": 400, "y": 550, "created_at": "2025-09-18T10:08:00"},
                {"id": 10, "name": "User Personalization", "description": "Maintain user preferences, provide personalized responses", "tech": "• SQLite (local preference database)\\n• JSON (lightweight local data storage)\\n• Rasa (offline chatbot framework)\\n• Llama 3 (offline conversational agent)", "x": 100, "y": 650, "created_at": "2025-09-18T10:09:00"},
                {"id": 11, "name": "Device Communication", "description": "Sync data across devices", "tech": "• MQTT (local message passing)\\n• WebSocket (real-time communication)", "x": 700, "y": 650, "created_at": "2025-09-18T10:10:00"},
                {"id": 12, "name": "Data Storage", "description": "Backup important files and data locally", "tech": "• Rsync (local backup synchronization)\\n• Tar (local backup creation)", "x": 50, "y": 750, "created_at": "2025-09-18T10:11:00"},
                {"id": 13, "name": "Health Monitoring", "description": "Track user activity locally, analyze health data offline", "tech": "• Local health data parsing (no cloud APIs)\\n• CSV/JSON local data storage\\n• Scikit-learn (offline activity prediction)\\n• TensorFlow (local health predictions)\\n• Custom health tracking algorithms", "x": 300, "y": 750, "created_at": "2025-09-18T10:12:00"},
                {"id": 14, "name": "System Monitoring", "description": "Monitor system performance and diagnostics", "tech": "• Custom monitoring scripts\\n• System resource tracking\\n• Performance metrics collection", "x": 550, "y": 750, "created_at": "2025-09-18T10:13:00"},
                {"id": 15, "name": "Data Analytics", "description": "Generate usage insights and reporting", "tech": "• Scikit-learn (data analysis)\\n• TensorFlow (predictive modeling)\\n• Data visualization libraries", "x": 800, "y": 750, "created_at": "2025-09-18T10:14:00"},
                {"id": 16, "name": "Offline Capabilities", "description": "Local processing without internet connectivity", "tech": "• Local model inference\\n• Offline speech recognition\\n• Local data processing", "x": 200, "y": 850, "created_at": "2025-09-18T10:15:00"},
                {"id": 17, "name": "Emotional Intelligence", "description": "Detect user emotions, respond empathetically", "tech": "• DeepMoji (offline emotion detection)\\n• OpenSmile (local audio emotion analysis)\\n• Hugging Face Transformers (offline sentiment)\\n• Llama 3 (offline emotional responses)\\n• Custom emotion recognition models", "x": 600, "y": 850, "created_at": "2025-09-18T10:16:00"},
                {"id": 18, "name": "Creativity", "description": "Generate stories, poems, creative content, suggest hobbies", "tech": "• GPT-2/Llama 3 (offline content generation)\\n• Rasa (offline creative conversations)\\n• Scikit-learn (local hobby recommendations)\\n• TensorFlow/PyTorch (offline ML models)\\n• Custom creativity algorithms", "x": 100, "y": 950, "created_at": "2025-09-18T10:17:00"},
                {"id": 19, "name": "Social Interaction", "description": "Natural conversation with humor and personality", "tech": "• Llama 3 (natural conversation)\\n• Humor generation algorithms\\n• Personality modeling", "x": 400, "y": 950, "created_at": "2025-09-18T10:18:00"},
                {"id": 20, "name": "Life Management", "description": "Personal assistant for daily life management", "tech": "• Task scheduling algorithms\\n• Calendar integration\\n• Reminder systems\\n• Productivity tracking", "x": 700, "y": 950, "created_at": "2025-09-18T10:19:00"},
                {"id": 21, "name": "Personal Memory", "description": "Keep journal of activities, track milestones and achievements", "tech": "• SQLite (local database for entries)\\n• JSON (lightweight entry storage)", "x": 250, "y": 1050, "created_at": "2025-09-18T10:20:00"},
                {"id": 22, "name": "Entertainment", "description": "Generate jokes, memes, and entertainment content", "tech": "• Llama 3/GPT-2 (offline humor generation)\\n• Pillow (local meme creation)\\n• Custom joke databases (local storage)\\n• Local entertainment content algorithms", "x": 550, "y": 1050, "created_at": "2025-09-18T10:21:00"},

                // Sub-components
                {"id": 23, "name": "Capture Voice", "description": "Real-time audio capture and preprocessing", "tech": "• PyAudio/sounddevice (microphone input)\\n• Wave format (local audio storage)\\n• NumPy (audio processing)\\n• Noise reduction algorithms\\n• Audio normalization", "x": 50, "y": 200, "created_at": "2025-09-18T10:22:00"},
                {"id": 24, "name": "Process Command", "description": "Offline speech-to-text processing with Whisper", "tech": "• OpenAI Whisper (offline model)\\n• PyTorch (local inference)\\n• Hugging Face Transformers (offline)\\n• Custom audio preprocessing\\n• Local model optimization", "x": 100, "y": 200, "created_at": "2025-09-18T10:23:00"},
                {"id": 25, "name": "Text to Speech", "description": "Offline voice synthesis and speech generation", "tech": "• pyttsx3 (offline TTS engine)\\n• espeak-ng (Linux offline TTS)\\n• Voice customization\\n• Emotion-aware speech\\n• SSML support (local)", "x": 150, "y": 200, "created_at": "2025-09-18T10:24:00"},
                {"id": 26, "name": "Detect Face", "description": "Advanced facial detection system", "x": 650, "y": 200, "created_at": "2025-09-18T10:25:00"},
                {"id": 27, "name": "Authenticate User", "description": "Secure facial authentication system", "x": 700, "y": 200, "created_at": "2025-09-18T10:26:00"},
                {"id": 28, "name": "Voice Verification", "description": "Optional voice auth", "x": 750, "y": 200, "created_at": "2025-09-18T10:27:00"},
                {"id": 29, "name": "Video Stream", "description": "Facial analysis capture", "x": 800, "y": 200, "created_at": "2025-09-18T10:28:00"},
                {"id": 30, "name": "Text Generation", "description": "Problem solving responses", "x": 300, "y": 300, "created_at": "2025-09-18T10:29:00"},
                {"id": 31, "name": "Human-like Response", "description": "Natural conversation", "x": 400, "y": 300, "created_at": "2025-09-18T10:30:00"},
                {"id": 32, "name": "Recommendations", "description": "Content suggestions", "x": 500, "y": 300, "created_at": "2025-09-18T10:31:00"},
                {"id": 33, "name": "Context Awareness", "description": "Decision making", "x": 350, "y": 320, "created_at": "2025-09-18T10:32:00"},
                {"id": 34, "name": "Humor Generation", "description": "Joke creation", "x": 450, "y": 320, "created_at": "2025-09-18T10:33:00"},
                {"id": 35, "name": "Twitter Scraping", "description": "Twitter data extraction and interaction", "x": 0, "y": 400, "created_at": "2025-09-18T10:34:00"},
                {"id": 36, "name": "Instagram API", "description": "Instagram automation and content management", "x": 50, "y": 400, "created_at": "2025-09-18T10:35:00"},
                {"id": 37, "name": "Facebook Graph", "description": "FB API integration", "x": 100, "y": 400, "created_at": "2025-09-18T10:36:00"},
                {"id": 38, "name": "Auto Posting", "description": "Content automation", "x": 25, "y": 420, "created_at": "2025-09-18T10:37:00"},
                {"id": 39, "name": "Trend Analysis", "description": "Topic & hashtag extraction", "x": 75, "y": 420, "created_at": "2025-09-18T10:38:00"},
                {"id": 40, "name": "Lighting Control", "description": "Advanced smart lighting system", "x": 700, "y": 400, "created_at": "2025-09-18T10:39:00"},
                {"id": 41, "name": "Temperature Control", "description": "Intelligent climate management system", "x": 750, "y": 400, "created_at": "2025-09-18T10:40:00"},
                {"id": 42, "name": "Security Cameras", "description": "Advanced security camera management", "x": 800, "y": 400, "created_at": "2025-09-18T10:41:00"},
                {"id": 43, "name": "Door Locks", "description": "Access control", "x": 725, "y": 420, "created_at": "2025-09-18T10:42:00"},
                {"id": 44, "name": "IoT Integration", "description": "Smart device connectivity", "x": 775, "y": 420, "created_at": "2025-09-18T10:43:00"}
            ];

            const connections = [
                {"id": 1, "parent_id": 1, "child_id": 2},
                {"id": 2, "parent_id": 1, "child_id": 3},
                {"id": 3, "parent_id": 2, "child_id": 4},
                {"id": 4, "parent_id": 3, "child_id": 4},
                {"id": 5, "parent_id": 4, "child_id": 5},
                {"id": 6, "parent_id": 4, "child_id": 6},
                {"id": 7, "parent_id": 4, "child_id": 7},
                {"id": 8, "parent_id": 4, "child_id": 8},
                {"id": 9, "parent_id": 4, "child_id": 10},
                {"id": 10, "parent_id": 9, "child_id": 11},
                {"id": 11, "parent_id": 11, "child_id": 12},
                {"id": 12, "parent_id": 10, "child_id": 13},
                {"id": 13, "parent_id": 11, "child_id": 14},
                {"id": 14, "parent_id": 12, "child_id": 15},
                {"id": 15, "parent_id": 4, "child_id": 16},
                {"id": 16, "parent_id": 4, "child_id": 17},
                {"id": 17, "parent_id": 17, "child_id": 18},
                {"id": 18, "parent_id": 17, "child_id": 19},
                {"id": 19, "parent_id": 10, "child_id": 20},
                {"id": 20, "parent_id": 20, "child_id": 21},
                {"id": 21, "parent_id": 19, "child_id": 22},
                {"id": 22, "parent_id": 2, "child_id": 23},
                {"id": 23, "parent_id": 23, "child_id": 24},
                {"id": 24, "parent_id": 24, "child_id": 25},
                {"id": 25, "parent_id": 3, "child_id": 26},
                {"id": 26, "parent_id": 26, "child_id": 27},
                {"id": 27, "parent_id": 27, "child_id": 28},
                {"id": 28, "parent_id": 3, "child_id": 29},
                {"id": 29, "parent_id": 4, "child_id": 30},
                {"id": 30, "parent_id": 4, "child_id": 31},
                {"id": 31, "parent_id": 4, "child_id": 32},
                {"id": 32, "parent_id": 4, "child_id": 33},
                {"id": 33, "parent_id": 4, "child_id": 34},
                {"id": 34, "parent_id": 5, "child_id": 35},
                {"id": 35, "parent_id": 5, "child_id": 36},
                {"id": 36, "parent_id": 5, "child_id": 37},
                {"id": 37, "parent_id": 5, "child_id": 38},
                {"id": 38, "parent_id": 5, "child_id": 39},
                {"id": 39, "parent_id": 6, "child_id": 40},
                {"id": 40, "parent_id": 6, "child_id": 41},
                {"id": 41, "parent_id": 6, "child_id": 42},
                {"id": 42, "parent_id": 6, "child_id": 43},
                {"id": 43, "parent_id": 6, "child_id": 44},
                {"id": 44, "parent_id": 8, "child_id": 15},
                {"id": 45, "parent_id": 7, "child_id": 14},
                {"id": 46, "parent_id": 13, "child_id": 15},
                {"id": 47, "parent_id": 16, "child_id": 4},
                {"id": 48, "parent_id": 9, "child_id": 12}
            ];

            // Transform data for D3
            nodes = tasks.map(task => ({
                id: task.id,
                name: task.name,
                description: task.description,
                tech: task.tech || "",
                x: task.x || width / 2 + Math.random() * 100 - 50,
                y: task.y || height / 2 + Math.random() * 100 - 50
            }));

            links = connections.map(conn => ({
                source: conn.parent_id,
                target: conn.child_id,
                id: conn.id
            }));

            renderGraph();
            updateStatus();
        }

        function renderGraph() {
            // Enhanced simulation for larger graphs with more space
            simulation = d3.forceSimulation(nodes)
                .force("link", d3.forceLink(links)
                    .id(d => d.id)
                    .distance(d => {
                        // Increased link distances for more space
                        const sourceDepth = getNodeDepth(d.source.id);
                        const targetDepth = getNodeDepth(d.target.id);
                        return sourceDepth === targetDepth ? 180 : 250;
                    })
                )
                .force("charge", d3.forceManyBody()
                    .strength(d => {
                        // Stronger repulsion for more spread
                        return isMainCategory(d.id) ? -2500 : -1200;
                    })
                )
                .force("center", d3.forceCenter(width / 2, height / 2).strength(0.05))
                .force("collision", d3.forceCollide()
                    .radius(d => isMainCategory(d.id) ? 95 : 75)
                )
                // Weaker Y-force to allow more natural positioning
                .force("y", d3.forceY()
                    .y(d => getNodeDepth(d.id) * 300 + 150)
                    .strength(0.05)
                );

            // Create links with enhanced styling
            link = g.append("g")
                .attr("class", "links")
                .selectAll(".link")
                .data(links)
                .enter().append("line")
                .attr("class", "link")
                .attr("stroke-width", d => {
                    // Thicker lines for main connections
                    return isMainConnection(d) ? 3 : 2;
                })
                .attr("opacity", 0.6);

            // Create node groups
            const nodeGroup = g.append("g")
                .attr("class", "nodes")
                .selectAll(".node")
                .data(nodes)
                .enter().append("g")
                .attr("class", "node")
                .call(d3.drag()
                    .on("start", dragstarted)
                    .on("drag", dragged)
                    .on("end", dragended));

            // Add circles to nodes with larger sizes
            nodeGroup.append("circle")
                .attr("class", "node-circle")
                .attr("r", d => isMainCategory(d.id) ? 85 : 65)
                .attr("fill", d => getNodeColor(d.id))
                .attr("stroke", d => d3.rgb(getNodeColor(d.id)).darker(0.5))
                .attr("stroke-width", 3)
                .style("filter", "drop-shadow(0 4px 8px rgba(0,0,0,0.3))")
                .on("click", function(event, d) {
                    event.stopPropagation();
                    // Handle node selection with highlighting
                    d3.selectAll(".node-circle").classed("selected", false);
                    d3.select(this).classed("selected", true);
                    highlightConnectedNodes(d.id);
                    selectedNode = d;
                    // Add sparkle effect on click
                    createNodeSparkles(d.x, d.y);
                    // Show description popup
                    showDescriptionPopup(event, d);
                })
                .on("mouseover", function(event, d) {
                    // Show tooltip on hover
                    showTooltip(event, d);
                    // Add subtle sparkle on hover
                    if (Math.random() < 0.3) {
                        createNodeSparkles(d.x, d.y, 3);
                    }
                })
                .on("mouseout", function() {
                    hideTooltip();
                });

            // Add single text label centered in circles
            nodeGroup.append("text")
                .attr("class", "node-label")
                .attr("dy", "0.35em")
                .attr("font-size", d => isMainCategory(d.id) ? "11px" : "10px")
                .attr("font-weight", d => isMainCategory(d.id) ? "bold" : "600")
                .attr("text-anchor", "middle")
                .style("fill", "white")
                .style("text-shadow", "1px 1px 2px rgba(0,0,0,0.7)")
                .each(function(d) {
                    const text = d3.select(this);
                    const words = d.name.split(' ');
                    const maxCharsPerLine = isMainCategory(d.id) ? 14 : 12;

                    let line = [];
                    let lineNumber = 0;
                    let tspan = text.append("tspan")
                        .attr("x", 0)
                        .attr("dy", "0em");

                    words.forEach(word => {
                        line.push(word);
                        tspan.text(line.join(' '));

                        if (tspan.node().getComputedTextLength() > maxCharsPerLine * 7) {
                            line.pop();
                            tspan.text(line.join(' '));

                            if (lineNumber < 1) { // Max 2 lines
                                line = [word];
                                lineNumber++;
                                tspan = text.append("tspan")
                                    .attr("x", 0)
                                    .attr("dy", "1.2em")
                                    .text(word);
                            }
                        }
                    });
                });

            // Store node reference globally
            node = nodeGroup;

            // Enhanced tick function with unrestricted movement
            simulation.on("tick", function() {
                // Update link positions
                link
                    .attr("x1", d => d.source.x)
                    .attr("y1", d => d.source.y)
                    .attr("x2", d => d.target.x)
                    .attr("y2", d => d.target.y);

                // Update node positions without boundaries - let them flow naturally
                node
                    .attr("transform", d => `translate(${d.x},${d.y})`);
            });

            // Longer simulation for better layout
            setTimeout(() => {
                if (simulation) {
                    simulation.alphaTarget(0.01);
                }
            }, 8000);

            setTimeout(() => {
                if (simulation) {
                    simulation.stop();
                }
                // Start periodic sparkles after layout settles
                startPeriodicSparkles();
            }, 12000);
        }

        // Helper functions for enhanced visualization
        function isMainCategory(nodeId) {
            return nodeId <= 22; // Main category nodes
        }

        function getNodeDepth(nodeId) {
            if (nodeId === 1) return 0; // Wake Word Detection (root)
            if (nodeId <= 3) return 1;  // Voice, Face Recognition
            if (nodeId === 4) return 2; // General AI (central hub)
            if (nodeId <= 22) return 3; // Other main categories
            return 4; // Sub-components
        }

        function getNodeColor(nodeId) {
            const colors = {
                1: '#FF6B6B',    // Wake Word - Red
                2: '#4ECDC4',    // Voice - Teal
                3: '#45B7D1',    // Face - Blue
                4: '#96CEB4',    // AI - Green
                5: '#FECA57',    // Social - Yellow
                6: '#FF9FF3',    // Smart Home - Pink
                7: '#54A0FF',    // Task Automation - Light Blue
                8: '#5F27CD',    // Web Scraping - Purple
                9: '#00D2D3',    // Security - Cyan
                10: '#FF9F43',   // Personalization - Orange
                11: '#EE5A24',   // Communication - Orange Red
                12: '#009432',   // Storage - Dark Green
                13: '#006BA6',   // Health - Dark Blue
                14: '#8B5CF6',   // System Monitor - Purple
                15: '#F59E0B',   // Analytics - Amber
                16: '#6B7280',   // Offline - Gray
                17: '#EC4899',   // Emotional - Pink
                18: '#8B5CF6',   // Creativity - Purple
                19: '#10B981',   // Social Interaction - Emerald
                20: '#3B82F6',   // Life Management - Blue
                21: '#F59E0B',   // Memory - Amber
                22: '#EF4444'    // Entertainment - Red
            };
            return colors[Math.min(nodeId, 22)] || '#94A3B8'; // Default gray for sub-components
        }

        function isMainConnection(link) {
            return link.source.id <= 22 && link.target.id <= 22;
        }

        function highlightConnectedNodes(nodeId) {
            // Reset all nodes
            d3.selectAll(".node-circle").attr("opacity", 0.3);
            d3.selectAll(".link").attr("opacity", 0.1);

            // Highlight selected node
            d3.select(`.node circle[r]`).filter(d => d.id === nodeId).attr("opacity", 1);

            // Highlight connected nodes and links
            links.forEach(link => {
                if (link.source.id === nodeId || link.target.id === nodeId) {
                    d3.selectAll(".link").filter(d => d.id === link.id).attr("opacity", 0.8);
                    d3.selectAll(".node-circle").filter(d => d.id === link.source.id || d.id === link.target.id).attr("opacity", 1);
                }
            });

            // Reset after 3 seconds
            setTimeout(() => {
                d3.selectAll(".node-circle").attr("opacity", 1);
                d3.selectAll(".link").attr("opacity", 0.6);
            }, 3000);
        }

        function showTooltip(event, d) {
            // Simple tooltip implementation
            const tooltip = d3.select("body").append("div")
                .attr("class", "tooltip")
                .style("position", "absolute")
                .style("background", "rgba(0,0,0,0.8)")
                .style("color", "white")
                .style("padding", "8px")
                .style("border-radius", "4px")
                .style("font-size", "12px")
                .style("pointer-events", "none")
                .style("z-index", "1000");

            tooltip.html(`<strong>${d.name}</strong><br/>${d.description}`)
                .style("left", (event.pageX + 10) + "px")
                .style("top", (event.pageY - 10) + "px");
        }

        function hideTooltip() {
            d3.selectAll(".tooltip").remove();
        }

        function createNodeSparkles(x, y, count = 6) {
            for (let i = 0; i < count; i++) {
                const angle = (i / count) * 2 * Math.PI;
                const distance = 60 + Math.random() * 20;
                const sparkleX = x + Math.cos(angle) * distance;
                const sparkleY = y + Math.sin(angle) * distance;

                const sparkle = g.append("use")
                    .attr("href", "#sparkle")
                    .attr("x", sparkleX)
                    .attr("y", sparkleY)
                    .attr("class", "star")
                    .style("opacity", 0)
                    .style("filter", "url(#star-glow)")
                    .style("animation", `twinkle 0.8s ease-out ${i * 0.1}s`);

                // Animate sparkle appearance and removal
                sparkle.transition()
                    .duration(200)
                    .style("opacity", 1)
                    .transition()
                    .delay(600)
                    .duration(400)
                    .style("opacity", 0)
                    .remove();
            }
        }

        function createConnectionSparkle() {
            // Add sparkles along connection lines occasionally
            if (Math.random() < 0.1) { // 10% chance
                d3.selectAll(".link").each(function(d) {
                    const line = d3.select(this);
                    const x1 = parseFloat(line.attr("x1"));
                    const y1 = parseFloat(line.attr("y1"));
                    const x2 = parseFloat(line.attr("x2"));
                    const y2 = parseFloat(line.attr("y2"));

                    // Random point along the line
                    const t = Math.random();
                    const sparkleX = x1 + t * (x2 - x1);
                    const sparkleY = y1 + t * (y2 - y1);

                    const sparkle = g.append("use")
                        .attr("href", "#sparkle")
                        .attr("x", sparkleX)
                        .attr("y", sparkleY)
                        .attr("class", "star floating")
                        .style("opacity", 0.6)
                        .style("filter", "url(#star-glow)");

                    sparkle.transition()
                        .delay(Math.random() * 2000)
                        .duration(1000)
                        .style("opacity", 0)
                        .remove();
                });
            }
        }

        function dragstarted(event, d) {
            if (!event.active) simulation.alphaTarget(0.3).restart();
            d.fx = d.x;
            d.fy = d.y;
        }

        function dragged(event, d) {
            d.fx = event.x;
            d.fy = event.y;
        }

        function dragended(event, d) {
            if (!event.active) simulation.alphaTarget(0);
            d.fx = null;
            d.fy = null;
        }

        function centerView() {
            if (!nodes || nodes.length === 0) return;

            // Calculate bounds of all nodes
            const bounds = nodes.reduce((acc, node) => ({
                minX: Math.min(acc.minX, node.x),
                minY: Math.min(acc.minY, node.y),
                maxX: Math.max(acc.maxX, node.x),
                maxY: Math.max(acc.maxY, node.y)
            }), { minX: Infinity, minY: Infinity, maxX: -Infinity, maxY: -Infinity });

            const centerX = (bounds.minX + bounds.maxX) / 2;
            const centerY = (bounds.minY + bounds.maxY) / 2;

            // Calculate scale to fit all nodes
            const scale = Math.min(
                width / (bounds.maxX - bounds.minX + 200),
                height / (bounds.maxY - bounds.minY + 200)
            );

            const transform = d3.zoomIdentity
                .translate(width / 2 - centerX * scale, height / 2 - centerY * scale)
                .scale(Math.min(scale, 1));

            svg.transition()
                .duration(1000)
                .call(d3.zoom().transform, transform);
        }

        function autoLayout() {
            if (simulation) {
                // Add sparkle burst effect
                nodes.forEach(node => {
                    if (Math.random() < 0.3) {
                        createNodeSparkles(node.x, node.y, 3);
                    }
                });

                // Restart simulation with more force
                simulation
                    .force("charge", d3.forceManyBody().strength(-1200))
                    .alpha(1)
                    .restart();

                // Reset to original charge after animation
                setTimeout(() => {
                    simulation.force("charge", d3.forceManyBody().strength(-800));
                }, 2000);
            }
        }

        function startPeriodicSparkles() {
            setInterval(() => {
                createConnectionSparkle();

                // Occasionally sparkle a random node
                if (Math.random() < 0.15 && nodes.length > 0) {
                    const randomNode = nodes[Math.floor(Math.random() * nodes.length)];
                    createNodeSparkles(randomNode.x, randomNode.y, 2);
                }
            }, 3000);
        }

        function zoomIn() {
            svg.transition().duration(300).call(
                d3.zoom().scaleBy, 1.2
            );
        }

        function zoomOut() {
            svg.transition().duration(300).call(
                d3.zoom().scaleBy, 0.8
            );
        }

        function resetZoom() {
            svg.transition().duration(500).call(
                d3.zoom().transform,
                d3.zoomIdentity
            );
        }

        function updateStatus() {
            document.getElementById('task-count').textContent = nodes.length;
            document.getElementById('connection-count').textContent = links.length;
        }

        // Description popup functions
        let currentNodePosition = { x: 0, y: 0 };

        function showDescriptionPopup(event, nodeData) {
            const popup = document.getElementById('description-popup');
            const title = document.getElementById('popup-title');
            const description = document.getElementById('popup-description');
            const techList = document.getElementById('popup-tech-list');
            const techSection = document.getElementById('popup-tech-section');
            const id = document.getElementById('popup-id');

            // Get the current zoom transform
            const transform = d3.zoomTransform(svg.node());

            // Calculate node position in screen coordinates
            const screenX = transform.applyX(nodeData.x);
            const screenY = transform.applyY(nodeData.y);

            // Store current node position for closing animation
            currentNodePosition = { x: screenX, y: screenY };

            // Populate popup content
            title.textContent = nodeData.name;
            description.textContent = nodeData.description || 'No description available';

            // Handle tech section

            if (nodeData.tech && nodeData.tech.trim()) {
                // Convert \n to actual line breaks for proper formatting
                techList.textContent = nodeData.tech.replace(/\\n/g, '\n');
                techSection.style.display = 'block';
            } else {
                techSection.style.display = 'none';
            }

            id.textContent = `Node ID: ${nodeData.id}`;

            // Position popup at node location initially
            popup.style.left = screenX + 'px';
            popup.style.top = screenY + 'px';
            popup.style.transform = 'translate(-50%, -50%)';

            // Remove any existing classes
            popup.classList.remove('show', 'closing');

            // Show popup at node position first (invisible)
            popup.style.display = 'block';

            // Animate from node position to center
            requestAnimationFrame(() => {
                popup.classList.add('show');
                // Move to center after a tiny delay
                setTimeout(() => {
                    popup.style.left = '50%';
                    popup.style.top = '50%';
                }, 50);
            });
        }

        function hideDescriptionPopup() {
            const popup = document.getElementById('description-popup');

            // Add closing class for different animation
            popup.classList.add('closing');
            popup.classList.remove('show');

            // Animate back to node position
            popup.style.left = currentNodePosition.x + 'px';
            popup.style.top = currentNodePosition.y + 'px';

            // Hide completely after animation
            setTimeout(() => {
                popup.style.display = 'none';
                popup.classList.remove('closing');
            }, 300);
        }

        // Add click-anywhere-to-close functionality
        document.addEventListener('click', function(event) {
            const popup = document.getElementById('description-popup');

            // If popup is visible and click is not on a node
            if (popup.classList.contains('show') &&
                !popup.contains(event.target) &&
                !event.target.closest('.node')) {
                hideDescriptionPopup();
            }
        });

        // Prevent popup from closing when clicking on the popup itself
        document.getElementById('description-popup').addEventListener('click', function(event) {
            event.stopPropagation();
        });
    </script>
</body>
</html>